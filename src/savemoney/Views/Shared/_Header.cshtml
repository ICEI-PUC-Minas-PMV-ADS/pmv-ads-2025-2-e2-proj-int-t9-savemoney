@* _Header.cshtml - Menu Padrao (Landing Page / Ambos) *@
@using System.Security.Claims

<header id="main-header">
    <div class="header-container">

        <a asp-controller="Home" asp-action="Index" class="header-logo" title="Inicio">
            Save Money
        </a>

        <nav class="header-nav">
            <ul class="header-nav-links">
                <li><a asp-controller="Home" asp-action="Controle">Controle</a></li>
                <li><a asp-controller="Home" asp-action="Investir">Investir</a></li>

                <!-- Perfis -->
                <li class="header-dropdown">
                    <a href="#">Perfis <i class="bi bi-chevron-down"></i></a>
                    <ul class="header-dropdown-menu">
                        <li><a asp-controller="Home" asp-action="PessoaFisica">Pessoa Fisica</a></li>
                        <li><a asp-controller="Home" asp-action="PessoaJuridica">Pessoa Juridica</a></li>
                    </ul>
                </li>

                <!-- Recursos -->
                <li class="header-dropdown">
                    <a href="#">Recursos <i class="bi bi-chevron-down"></i></a>
                    <ul class="header-dropdown-menu">
                        <li><a asp-controller="Ferramentas" asp-action="CalculadoraDeMetas">Calculadora</a></li>
                        <li><a asp-controller="Ferramentas" asp-action="JurosCompostos">Juros Compostos</a></li>
                        <li><a asp-controller="ConversorEnergias" asp-action="Index">Economia de Energia</a></li>
                    </ul>
                </li>

                <li><a asp-controller="Home" asp-action="Metas">Metas</a></li>

                @* Menu Admin - Apenas para Administradores *@
                @if (User.Identity != null && User.Identity.IsAuthenticated && User.IsInRole("Administrador"))
                {
                    <li class="header-dropdown">
                        <a href="#" class="text-danger">
                            <i class="bi bi-shield-fill"></i> Admin <i class="bi bi-chevron-down"></i>
                        </a>
                        <ul class="header-dropdown-menu">
                            <li>
                                <a asp-controller="Usuarios" asp-action="Index">
                                    <i class="bi bi-people-fill"></i> Usuários
                                </a>
                            </li>
                            <li>
                                <a asp-controller="BugReport" asp-action="Listar">
                                    <i class="bi bi-bug-fill"></i> Bug Reports
                                </a>
                            </li>
                        </ul>
                    </li>
                }
            </ul>
        </nav>

        <div class="header-actions">
            @if (User.Identity != null && User.Identity.IsAuthenticated)
            {
                @* Usuario LOGADO *@
                var currentUserId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
                var userName = User.Identity.Name ?? "User";
                var initials = userName.Length >= 2 ? userName.Substring(0, 2).ToUpper() : userName.ToUpper();

                <div class="header-user-avatar" title="@userName">
                    <span>@initials</span>
                </div>

                <a asp-controller="Dashboard" asp-action="Index" class="header-btn header-btn-primary">
                    Painel
                </a>
            }
            else
            {
                @* Usuario NAO LOGADO *@
                <a asp-controller="Usuarios" asp-action="Login" class="header-btn header-btn-primary">
                    Entrar
                </a>
            }
        </div>

        <button class="header-mobile-toggle" id="mobile-menu-toggle" aria-label="Menu">
            <i class="bi bi-list"></i>
        </button>
    </div>

    <!-- Menu Mobile -->
    <nav id="mobile-nav-drawer" class="mobile-nav-drawer">
        <ul class="mobile-nav-links">
            <li><a asp-controller="Home" asp-action="Controle" data-dismiss="mobile-nav">Controle</a></li>
            <li><a asp-controller="Home" asp-action="Investir" data-dismiss="mobile-nav">Investir</a></li>

            <!-- Perfis Mobile -->
            <li class="mobile-dropdown">
                <button class="mobile-dropdown-toggle">Perfis <i class="bi bi-chevron-down"></i></button>
                <ul class="mobile-dropdown-menu">
                    <li><a asp-controller="Home" asp-action="PessoaFisica" data-dismiss="mobile-nav">Pessoa Fisica</a></li>
                    <li><a asp-controller="Home" asp-action="PessoaJuridica" data-dismiss="mobile-nav">Pessoa Juridica</a></li>
                </ul>
            </li>

            <!-- Recursos Mobile -->
            <li class="mobile-dropdown">
                <button class="mobile-dropdown-toggle">Recursos <i class="bi bi-chevron-down"></i></button>
                <ul class="mobile-dropdown-menu">
                    <li><a asp-controller="Ferramentas" asp-action="CalculadoraDeMetas" data-dismiss="mobile-nav">Calculadora</a></li>
                    <li><a asp-controller="Ferramentas" asp-action="JurosCompostos" data-dismiss="mobile-nav">Juros Compostos</a></li>
                    <li><a asp-controller="ConversorEnergias" asp-action="Index" data-dismiss="mobile-nav">Economia de Energia</a></li>
                </ul>
            </li>

            <li><a asp-controller="Home" asp-action="Metas" data-dismiss="mobile-nav">Metas</a></li>

            @* Menu Admin Mobile - Apenas para Administradores *@
            @if (User.Identity != null && User.Identity.IsAuthenticated && User.IsInRole("Administrador"))
            {
                <li class="mobile-dropdown">
                    <button class="mobile-dropdown-toggle text-danger">
                        <i class="bi bi-shield-fill"></i> Admin <i class="bi bi-chevron-down"></i>
                    </button>
                    <ul class="mobile-dropdown-menu">
                        <li>
                            <a asp-controller="Usuarios" asp-action="Index" data-dismiss="mobile-nav">
                                <i class="bi bi-people-fill"></i> Usuários
                            </a>
                        </li>
                        <li>
                            <a asp-controller="BugReport" asp-action="Listar" data-dismiss="mobile-nav">
                                <i class="bi bi-bug-fill"></i> Bug Reports
                            </a>
                        </li>
                    </ul>
                </li>
            }

            @if (User.Identity != null && User.Identity.IsAuthenticated)
            {
                <li><a asp-controller="Dashboard" asp-action="Index" data-dismiss="mobile-nav" class="text-primary">Painel</a></li>
                <li><a asp-controller="Usuarios" asp-action="Logout" data-dismiss="mobile-nav" class="text-danger">Sair</a></li>
            }
            else
            {
                <li><a asp-controller="Usuarios" asp-action="Login" data-dismiss="mobile-nav" class="text-primary">Entrar</a></li>
            }
        </ul>
    </nav>

    <button id="header-toggle-tab" class="header-toggle-tab" title="Alternar Menu">
        <i class="bi bi-chevron-up"></i>
    </button>
</header>
