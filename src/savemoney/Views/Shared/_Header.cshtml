@using System.Security.Claims

@{
    bool isLandingPage = (ViewData["Title"] as string) == "Save Money - Gestão Financeira Premium";
    var currentUserId = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
    var userPhotoUrl = "https://ui-avatars.com/api/?name=" + (User.FindFirst(ClaimTypes.Name)?.Value ?? "SM") + "&background=3b82f6&color=fff&size=200&bold=true"; // Exemplo, idealmente viria do modelo Usuario
}

<header id="main-header">
    <div class="header-container">

        <a asp-controller="@(User.Identity.IsAuthenticated ? "Dashboard" : "LandingPage")" asp-action="Index" class="header-logo">
            Save Money
        </a>

        <button id="mobile-menu-toggle" class="header-mobile-toggle" aria-label="Abrir menu de navegação">
            <i class="bi bi-list"></i>
        </button>

        <nav class="header-nav" id="header-nav-desktop">
            <ul class="header-nav-links">

                @if (isLandingPage)
                {
                    <li><a href="#control">Controle</a></li>
                    <li><a href="#invest">Investir</a></li>
                    <li class="header-dropdown">
                        <a href="#">Perfis <i class="bi bi-chevron-down"></i></a>
                        <ul class="header-dropdown-menu">
                            <li><a href="#profiles">Pessoa Física</a></li>
                            <li><a href="#profiles">Pessoa Jurídica</a></li>
                        </ul>
                    </li>
                    <li class="header-dropdown">
                        <a href="#">Relatórios <i class="bi bi-chevron-down"></i></a>
                        <ul class="header-dropdown-menu">
                            <li><a href="#reports">Diagnósticos</a></li>
                            <li><a href="#reports">Análise de Tendências</a></li>
                        </ul>
                    </li>
                    <li><a href="#goals">Metas</a></li>
                    <li><a href="#customize">Personalizar</a></li>
                }
                else
                {
                    <li><a asp-controller="Dashboard" asp-action="Index">Painel</a></li>

                    <li class="header-dropdown">
                        <a href="#">Gestão <i class="bi bi-chevron-down"></i></a>
                        <ul class="header-dropdown-menu">
                            <li><a asp-controller="Receitas" asp-action="Index">Receitas</a></li>
                            <li><a asp-controller="Despesas" asp-action="Index">Despesas</a></li>
                            <li><a asp-controller="Categories" asp-action="Index">Categorias</a></li>
                        </ul>
                    </li>

                    <li class="header-dropdown">
                        <a href="#">Estratégia <i class="bi bi-chevron-down"></i></a>
                        <ul class="header-dropdown-menu">
                            <li><a asp-controller="Budgets" asp-action="Index">Orçamentos</a></li>
                            <li><a asp-controller="MetasFinanceiras" asp-action="Index">Metas</a></li>
                            <li><a asp-page="/Relatorios">Relatórios</a></li>
                            <li><hr class="dropdown-divider" style="border-color: rgba(255,255,255,0.1); margin: 0.5rem 0;"></li>
                            <li><a asp-controller="TendenciaFinanceira" asp-action="Index">Tendências</a></li>
                            <li><a asp-controller="ProjecaoFinanceira" asp-action="Index" style="color: #3b82f6;">Projeção Futura</a></li>
                        </ul>
                    </li>

                    <li class="header-dropdown">
                        <a href="#">Ferramentas <i class="bi bi-chevron-down"></i></a>
                        <ul class="header-dropdown-menu">
                            <li><a asp-controller="Ferramentas" asp-action="CalculadoraDeMetas">Calc. Metas</a></li>
                            <li><a asp-controller="Ferramentas" asp-action="CalculadoraDeEquilibrio">Ponto de Equilíbrio</a></li>
                            <li><a asp-controller="ConversorEnergias" asp-action="Index">Conversor Energia</a></li>
                        </ul>
                    </li>

                    <li><a asp-controller="EducacaoFinanceira" asp-action="Index">Educação</a></li>

                    @if (User.IsInRole("Administrador"))
                    {
                        <li><a asp-controller="Usuarios" asp-action="Index">Usuários</a></li>
                    }
                }
            </ul>
        </nav>
        <div class="header-actions">
            @if (User.Identity.IsAuthenticated)
            {
                <a asp-controller="Usuarios" asp-action="Details" asp-route-id="@currentUserId"
                   class="header-btn header-btn-icon" title="Meu Perfil">
                    <img src="@userPhotoUrl" alt="Foto de Perfil" class="profile-photo-icon" />
                </a>

                @if (isLandingPage)
                {
                    <a asp-controller="Dashboard" asp-action="Index" class="header-btn header-btn-primary">Painel</a>
                }
                else
                {
                    <a asp-controller="Usuarios" asp-action="Logout" class="header-btn header-btn-primary">Sair</a>
                }
            }
            else
            {
                <a asp-controller="Usuarios" asp-action="Login" class="header-btn header-btn-primary">Entrar</a>
            }
        </div>

    </div>

    <div id="mobile-nav-drawer" class="mobile-nav-drawer">
        <ul class="mobile-nav-links">
            @if (isLandingPage)
            {
                <li><a href="#control" data-dismiss="mobile-nav">Controle</a></li>
                <li><a href="#invest" data-dismiss="mobile-nav">Investir</a></li>
                <li><a href="#profiles" data-dismiss="mobile-nav">Perfis</a></li>
                <li><a href="#reports" data-dismiss="mobile-nav">Relatórios</a></li>
                <li><a href="#goals" data-dismiss="mobile-nav">Metas</a></li>
                <li><a href="#customize" data-dismiss="mobile-nav">Personalizar</a></li>
            }
            else
            {
                <li><a asp-controller="Dashboard" asp-action="Index" data-dismiss="mobile-nav">Painel</a></li>

                <li class="mobile-dropdown">
                    <button class="mobile-dropdown-toggle">Gestão <i class="bi bi-chevron-down"></i></button>
                    <ul class="mobile-dropdown-menu">
                        <li><a asp-controller="Receitas" asp-action="Index" data-dismiss="mobile-nav">Receitas</a></li>
                        <li><a asp-controller="Despesas" asp-action="Index" data-dismiss="mobile-nav">Despesas</a></li>
                        <li><a asp-controller="Categories" asp-action="Index" data-dismiss="mobile-nav">Categorias</a></li>
                    </ul>
                </li>

                <li class="mobile-dropdown">
                    <button class="mobile-dropdown-toggle">Estratégia <i class="bi bi-chevron-down"></i></button>
                    <ul class="mobile-dropdown-menu">
                        <li><a asp-controller="Budgets" asp-action="Index" data-dismiss="mobile-nav">Orçamentos</a></li>
                        <li><a asp-controller="MetasFinanceiras" asp-action="Index" data-dismiss="mobile-nav">Metas</a></li>
                        <li><a asp-controller="TendenciaFinanceira" asp-action="Index" data-dismiss="mobile-nav">Tendências</a></li>
                        <li><a asp-controller="ProjecaoFinanceira" asp-action="Index" style="color: #3b82f6;" data-dismiss="mobile-nav">Projeção Futura</a></li>
                    </ul>
                </li>

                <li class="mobile-dropdown">
                    <button class="mobile-dropdown-toggle">Ferramentas <i class="bi bi-chevron-down"></i></button>
                    <ul class="mobile-dropdown-menu">
                        <li><a asp-controller="Ferramentas" asp-action="CalculadoraDeMetas" data-dismiss="mobile-nav">Calc. Metas</a></li>
                        <li><a asp-controller="Ferramentas" asp-action="CalculadoraDeEquilibrio" data-dismiss="mobile-nav">Ponto de Equilíbrio</a></li>
                        <li><a asp-controller="ConversorEnergias" asp-action="Index" data-dismiss="mobile-nav">Conversor Energia</a></li>
                    </ul>
                </li>

                <li><a asp-controller="EducacaoFinanceira" asp-action="Index" data-dismiss="mobile-nav">Educação</a></li>

                @if (User.IsInRole("Administrador"))
                {
                    <li><a asp-controller="Usuarios" asp-action="Index" data-dismiss="mobile-nav">Usuários</a></li>
                }
            }
        </ul>
    </div>
    <button id="header-toggle-tab" class="header-toggle-tab" title="Alternar Menu">
        <i class="bi bi-chevron-up"></i>
    </button>
</header>