<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- Configurações essenciais do meu documento HTML -->
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- O título da aba do navegador. Ele vai pegar o que eu definir em cada página (View) e adicionar "- Save Money" -->
    <title>@ViewData["Title"] - Save Money</title>

    <!-- Links para as fontes que eu escolhi para o design do site -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Licorice&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Links para as folhas de estilo (CSS). O '~/' é um atalho para a pasta wwwroot -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <!-- Link para o meu componente de Web Components 'catedral', que vai gerir o header e outras partes -->
    <script src="~/lib/catedral/catedral.js" type="module" asp-append-version="true"></script>
</head>
<body class="body-hidden">
    <!-- Aqui eu uso o meu componente de cabeçalho personalizado -->
    <catedral-header title="Save Money">
        
        <!-- Bloco de código C# para pegar o ID do usuário se ele estiver logado -->
        @{
            var userId = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
        }

        <!-- Este é o ícone de perfil. A lógica aqui é inteligente: -->
        <!-- Se o usuário estiver logado, o link leva para a sua página de detalhes. -->
        <!-- Se não estiver, o mesmo ícone leva para a página de Login. -->
        <a slot="profile"
           asp-controller="Usuarios"
           asp-action="@(User.Identity.IsAuthenticated ? "Details" : "Login")"
           asp-route-id="@(User.Identity.IsAuthenticated ? userId : null)"
           aria-label="Perfil">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="8" r="4" />
                <path d="M4 20c0-4 8-6 8-6s8 2 8 6" />
            </svg>
        </a>

        <!-- Minha barra de navegação principal -->
        <nav class="header-navigation">
            <ul>
                <li class="nav-item">
                    <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">
                        <span class="material-icons">home</span>Home
                    </a>
                </li>

                <!-- A lógica aqui mostra links especiais apenas se o usuário for um 'Administrador' -->
                @if (User.IsInRole("Administrador") && User.Identity.IsAuthenticated)
                { 
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Usuarios" asp-action="Index">
                            <span class="material-icons">group</span>Usuarios
                        </a>
                    </li>
                }

                <!-- A lógica aqui mostra o menu principal apenas se o usuário estiver LOGADO -->
                @if(User.Identity.IsAuthenticated)
                {
                    <!-- ====================================================== -->
                    <!-- LINKS PARA AS FUNCIONALIDADES PRINCIPAIS -->
                    <!-- ====================================================== -->
                    
                    <!-- Link para a página de Educação Financeira -->
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="EducacaoFinanceira" asp-action="Index">
                            <span class="material-icons">school</span>Educação Financeira
                        </a>
                    </li>

                    <!-- Links para as Ferramentas (R15) -->
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Ferramentas" asp-action="CalculadoraDeMetas">
                            <span class="material-icons">calculate</span>Calculadora de Metas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Ferramentas" asp-action="CalculadoraDeEquilibrio">
                            <span class="material-icons">insights</span>Ponto de Equilíbrio
                        </a>
                    </li>

                    <!-- Link para o Conversor de Energia (R3) -->
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="ConversorEnergias" asp-action="Index">
                            <span class="material-icons">bolt</span>Conversor de Energia
                        </a>
                    </li>

                    <!-- Link para Relatórios -->
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-controller="Receitas" asp-action="Index">Receitas</a>
                    </li>

                    <!-- ====================================================== -->
                    <!-- LINKS DE NAVEGAÇÃO GERAL -->
                    <!-- ====================================================== -->
                    
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Privacy">
                            <span class="material-icons">privacy_tip</span>Privacidade
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Usuarios" asp-action="Logout">
                            <span class="material-icons">logout</span>Sair
                        </a>
                    </li>
                }
                else // Se o usuário NÃO estiver logado...
                {
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Privacy">
                            <span class="material-icons">privacy_tip</span>Privacidade
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" asp-area="" asp-controller="Usuarios" asp-action="Login">
                            <span class="material-icons">login</span>Login
                        </a>
                    </li>
                }
            </ul>
        </nav>
    </catedral-header>

    <!-- Esta é a área principal onde o conteúdo de cada página (View) será renderizado. É a parte "mágica" do layout. -->
    <main role="main" class="pb-5 pt-5">
        @RenderBody()
    </main>

    <footer class="border-top footer text-muted">
        <div class="container text-center">
            &copy; @DateTime.Now.Year - Save Money - <a asp-area="" asp-controller="Home" asp-action="Privacy">Política de Privacidade</a>
            <catedral-logo></catedral-logo>
        </div>
    </footer>

    <!-- Meus scripts JavaScript são carregados no final para a página carregar mais rápido -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    
    <!-- Esta seção permite que páginas específicas (Views) injetem seus próprios scripts aqui, se precisarem -->
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

