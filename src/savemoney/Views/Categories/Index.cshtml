@model IEnumerable<savemoney.Models.Category>
@using savemoney.Models.Enums

@{
    ViewData["Title"] = "Categorias";
}

@section css {
    <link rel="stylesheet" href="~/css/categories.css" asp-append-version="true" />
}

<div class="categories-page-main fade-in">

    <!-- Cabecalho -->
    <header class="page-header">
        <div class="header-content">
            <h1 class="page-title">Categorias</h1>
            <p class="page-subtitle">Gerencie as categorias das suas transacoes.</p>
        </div>
        <button class="btn-action btn-primary"
                onclick="carregarModalCriar()"
                aria-label="Criar nova categoria">
            <i class="bi bi-plus-lg" aria-hidden="true"></i>
            <span>Nova Categoria</span>
        </button>
    </header>

    <!-- Estado vazio -->
    @if (!Model.Any())
    {
        <div class="empty-state glass-panel">
            <div class="empty-icon" aria-hidden="true">
                <i class="bi bi-tags"></i>
            </div>
            <h2>Nenhuma categoria encontrada</h2>
            <p>Crie categorias para organizar suas receitas e despesas.</p>
            <button class="btn-action btn-secondary" onclick="carregarModalCriar()">
                Criar Primeira Categoria
            </button>
        </div>
    }
    else
    {
        <!-- Lista de categorias -->
        <div class="glass-panel">
            <ul class="categories-list" role="list">
                @foreach (var item in Model)
                {
                    <li class="category-item" role="listitem">
                        <div class="category-info">
                            <div class="category-icon @GetIconClass(item.TipoContabil)" aria-hidden="true">
                                <i class="bi @GetIconName(item.TipoContabil)"></i>
                            </div>
                            <div class="category-details">
                                <h3 class="category-name">@item.Name</h3>
                                <div class="category-badges">
                                    <span class="badge @GetBadgeClass(item.TipoContabil)">
                                        @GetTipoContabilDisplay(item.TipoContabil)
                                    </span>
                                    @if (item.IsPredefined)
                                    {
                                        <span class="badge badge-system">Sistema</span>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="category-actions">
                            <button class="btn-icon"
                                    onclick="carregarModalEditar(@item.Id)"
                                    title="Editar categoria @item.Name"
                                    aria-label="Editar categoria @item.Name">
                                <i class="bi bi-pencil-fill" aria-hidden="true"></i>
                            </button>
                            @if (!item.IsPredefined)
                            {
                                <button class="btn-icon danger"
                                        onclick="confirmarExclusao(@item.Id)"
                                        title="Excluir categoria @item.Name"
                                        aria-label="Excluir categoria @item.Name">
                                    <i class="bi bi-trash-fill" aria-hidden="true"></i>
                                </button>
                            }
                        </div>
                    </li>
                }
            </ul>
        </div>

        <!-- Legenda dos tipos -->
        <div class="tipos-legenda glass-panel">
            <h4><i class="bi bi-info-circle"></i> Legenda dos Tipos Contabeis</h4>
            <div class="legenda-grid">
                <div class="legenda-item">
                    <span class="badge badge-receita">Receita</span>
                    <span>Entradas de dinheiro</span>
                </div>
                <div class="legenda-item">
                    <span class="badge badge-custo">Custo Variavel</span>
                    <span>Custos de producao/venda</span>
                </div>
                <div class="legenda-item">
                    <span class="badge badge-fixo">Despesa Fixa</span>
                    <span>Gastos fixos mensais</span>
                </div>
                <div class="legenda-item">
                    <span class="badge badge-operacional">Despesa Operacional</span>
                    <span>Gastos do dia-a-dia</span>
                </div>
                <div class="legenda-item">
                    <span class="badge badge-investimento">Investimento</span>
                    <span>Aplicacoes e bens</span>
                </div>
            </div>
        </div>
    }
</div>

<!-- Container para modais dinamicos -->
<div id="modal-container"></div>

<!-- Modal de confirmacao de exclusao -->
<div class="modal fade"
     id="deleteModal"
     tabindex="-1"
     aria-labelledby="deleteModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content glass-panel">
            <div class="modal-body text-center p-4">
                <div class="modal-icon-warning" aria-hidden="true">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
                <h2 id="deleteModalLabel" class="modal-title-warning">Excluir Categoria?</h2>
                <p class="modal-text-secondary">Essa acao nao pode ser desfeita.</p>
                <div class="modal-actions">
                    <button type="button"
                            class="btn-action btn-secondary"
                            data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="button"
                            class="btn-action btn-danger"
                            onclick="executarExclusao()">
                        Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/categories.js" asp-append-version="true"></script>
    <partial name="_ValidationScriptsPartial" />
}

@functions {
    string GetBadgeClass(TipoContabil tipo)
    {
        return tipo switch
        {
            TipoContabil.Receita => "badge-receita",
            TipoContabil.CustoVariavel => "badge-custo",
            TipoContabil.DespesaFixa => "badge-fixo",
            TipoContabil.DespesaOperacional => "badge-operacional",
            TipoContabil.Investimento => "badge-investimento",
            _ => "badge-default"
        };
    }

    string GetIconClass(TipoContabil tipo)
    {
        return tipo switch
        {
            TipoContabil.Receita => "icon-receita",
            TipoContabil.CustoVariavel => "icon-custo",
            TipoContabil.DespesaFixa => "icon-fixo",
            TipoContabil.DespesaOperacional => "icon-operacional",
            TipoContabil.Investimento => "icon-investimento",
            _ => ""
        };
    }

    string GetIconName(TipoContabil tipo)
    {
        return tipo switch
        {
            TipoContabil.Receita => "bi-arrow-up-circle-fill",
            TipoContabil.CustoVariavel => "bi-box-fill",
            TipoContabil.DespesaFixa => "bi-building-fill",
            TipoContabil.DespesaOperacional => "bi-gear-fill",
            TipoContabil.Investimento => "bi-graph-up-arrow",
            _ => "bi-tag-fill"
        };
    }

    string GetTipoContabilDisplay(TipoContabil tipo)
    {
        return tipo switch
        {
            TipoContabil.Receita => "Receita",
            TipoContabil.CustoVariavel => "Custo Variavel",
            TipoContabil.DespesaFixa => "Despesa Fixa",
            TipoContabil.DespesaOperacional => "Desp. Operacional",
            TipoContabil.Investimento => "Investimento",
            _ => "Nao Classificado"
        };
    }
}
