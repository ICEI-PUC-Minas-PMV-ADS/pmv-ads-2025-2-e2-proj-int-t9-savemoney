@model savemoney.Models.Despesa
@using savemoney.Models

@{
    bool isEdit = Model.Id != 0;
    string title = isEdit ? "Editar Despesa" : "Nova Despesa";
    string subtitle = isEdit ? "Atualize as informações da despesa." : "Registre seus gastos para manter o controle.";
}

<div class="modal-header">
    <div>
        <h2 class="modal-title">@title</h2>
        <p class="modal-subtitle">@subtitle</p>
    </div>
    <button type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Fechar"></button>
</div>

<div class="modal-body">
    <form action="/Despesas/@(isEdit ? "Edit" : "Create")/@(isEdit ? Model.Id.ToString() : "")"
          method="post"
          id="formDespesa"
          aria-labelledby="despesaModalLabel">

        @Html.AntiForgeryToken()

        @if (isEdit)
        {
            <input type="hidden" asp-for="Id" />
        }

        <!-- Valor e Moeda -->
        <div class="amount-group">
            <div class="currency-selector">
                <select asp-for="CurrencyType"
                        id="currencyType"
                        class="form-input form-input-sm"
                        aria-label="Selecionar moeda">
                    <option value="BRL">BRL</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                </select>
            </div>
            <div class="amount-input-wrapper">
                <span id="currencySymbol" class="currency-symbol">R$</span>
                <input asp-for="Valor"
                       class="amount-input"
                       type="text"
                       placeholder="0,00"
                       autocomplete="off"
                       required />
            </div>
        </div>
        <span asp-validation-for="Valor" class="form-error"></span>

        <!-- Título -->
        <div class="form-group">
            <label asp-for="Titulo" class="form-label">Descrição</label>
            <input asp-for="Titulo"
                   class="form-input"
                   placeholder="Ex: Aluguel, Mercado, Uber..."
                   required />
            <span asp-validation-for="Titulo" class="form-error"></span>
        </div>

        <!-- Categoria do Orçamento -->
        <div class="form-group">
            <label asp-for="BudgetCategoryId" class="form-label">Categoria (Orçamento)</label>
            <select asp-for="BudgetCategoryId"
                    asp-items="ViewBag.BudgetCategories"
                    class="form-input">
            </select>
            <small class="form-hint">
                Vincular a uma categoria ajuda a controlar seu teto de gastos.
            </small>
        </div>

        <!-- Datas -->
        <div class="form-grid-2">
            <div class="form-group">
                <label asp-for="DataInicio" class="form-label">Vencimento</label>
                <input type="date"
                       asp-for="DataInicio"
                       class="form-input"
                       required />
            </div>
            <div class="form-group">
                <label asp-for="DataFim" class="form-label">Competência</label>
                <input type="date"
                       asp-for="DataFim"
                       class="form-input" />
            </div>
        </div>

        <div class="form-divider"></div>

        <!-- Recorrência -->
        <div class="toggle-row">
            <div class="toggle-info">
                <span class="toggle-label">Recorrência</span>
                <span class="toggle-desc">Esta despesa se repete?</span>
            </div>
            <label class="toggle-switch">
                <input asp-for="IsRecurring"
                       type="checkbox"
                       id="isRecurringSwitch">
                <span class="toggle-slider"></span>
            </label>
        </div>

        <!-- Opções de recorrência -->
        <div class="recurrence-panel form-grid-2"
             id="recurrenceOptions"
             style="display: @(Model.IsRecurring ? "grid" : "none");">
            <div class="form-group">
                <label asp-for="Recurrence" class="form-label">Frequência</label>
                <select asp-for="Recurrence"
                        asp-items="Html.GetEnumSelectList<Despesa.RecurrenceType>()"
                        class="form-input">
                </select>
            </div>
            <div class="form-group">
                <label asp-for="RecurrenceCount" class="form-label">Repetições</label>
                <input asp-for="RecurrenceCount"
                       class="form-input"
                       type="number"
                       min="1"
                       placeholder="∞" />
            </div>
        </div>

        <!-- Status de pagamento -->
        <div class="toggle-row">
            <div class="toggle-info">
                <span class="toggle-label">Status de Pagamento</span>
                <span class="toggle-desc">Já foi pago?</span>
            </div>
            <label class="toggle-switch">
                <input asp-for="Pago" type="checkbox">
                <span class="toggle-slider success"></span>
            </label>
        </div>

        <div class="form-actions">
            <button type="button"
                    class="btn-action btn-secondary"
                    data-bs-dismiss="modal">
                Cancelar
            </button>
            <button type="submit" class="btn-action btn-danger">
                @(isEdit ? "Salvar Alterações" : "Salvar Despesa")
            </button>
        </div>
    </form>
</div>

<partial name="_ValidationScriptsPartial" />