@model savemoney.Models.ConversorEnergia

@{
    bool isEdit = Model.Id != 0;
    string title = isEdit ? "Editar Conversão Salva" : "Nova Conversão de Energia";
    string subtitle = isEdit ? "Atualize os dados da sua conversão." : "Preencha os dados para calcular consumo e custo de energia.";
}

<div class="modal-header">
    <div>
        <h2 class="modal-title">@title</h2>
        <p class="modal-subtitle">@subtitle</p>
    </div>
    <button type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Fechar"></button>
</div>

<div class="modal-body">
    <form asp-action="CreateOrEdit"
          method="post"
          id="formConversor"
          aria-labelledby="conversorModalLabel">

        @Html.AntiForgeryToken()

        @if (isEdit)
        {
            <input type="hidden" asp-for="Id" />
        }

        <div asp-validation-summary="ModelOnly" class="alert-danger"></div>

        <div class="form-grid">
            <!-- Valor Base -->
            <div class="form-group">
                <label asp-for="ValorBase" class="form-label">
                    1. Valor Base
                </label>
                <input asp-for="ValorBase"
                       class="form-input"
                       type="number"
                       step="0.01"
                       placeholder="Ex: 5500 (Watts) ou 120,50 (Reais)"
                       required />
                <span asp-validation-for="ValorBase" class="form-error"></span>
            </div>

            <!-- Tipo de Valor -->
            <div class="form-group">
                <label asp-for="TipoValor" class="form-label">
                    2. Unidade
                </label>
                <select asp-for="TipoValor"
                        class="form-input"
                        asp-items="ViewBag.TipoValorOptions"
                        required>
                    <option value="">Selecione Watts ou Reais</option>
                </select>
                <span asp-validation-for="TipoValor" class="form-error"></span>
                <small class="form-hint">Watts: potência do aparelho | Reais: valor da conta</small>
            </div>

            <!-- Tipo de Dispositivo -->
            <div class="form-group">
                <label asp-for="TipoDispositivo" class="form-label">
                    3. Tipo de Aparelho
                </label>
                <select asp-for="TipoDispositivo"
                        class="form-input"
                        asp-items="ViewBag.Dispositivos"
                        required>
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="TipoDispositivo" class="form-error"></span>
            </div>

            <!-- Tempo de Uso -->
            <div class="form-group">
                <label asp-for="TempoUso" class="form-label">
                    4. Tempo de Uso (horas/dia)
                </label>
                <input asp-for="TempoUso"
                       class="form-input"
                       type="number"
                       step="0.1"
                       min="0.1"
                       max="24"
                       placeholder="Ex: 5 ou 2.5"
                       required />
                <span asp-validation-for="TempoUso" class="form-error"></span>
                <small class="form-hint">Quantas horas por dia o aparelho fica ligado</small>
            </div>

            <!-- Estado -->
            <div class="form-group">
                <label asp-for="Estado" class="form-label">
                    5. Estado
                </label>
                <select asp-for="Estado"
                        class="form-input"
                        asp-items="ViewBag.EstadosBrasil"
                        required>
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="Estado" class="form-error"></span>
            </div>

            <!-- Modalidade -->
            <div class="form-group">
                <label asp-for="Modalidade" class="form-label">
                    6. Modalidade
                </label>
                <select asp-for="Modalidade"
                        class="form-input"
                        asp-items="ViewBag.Modalidades"
                        required>
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="Modalidade" class="form-error"></span>
            </div>

            <!-- Bandeira Tarifária -->
            <div class="form-group">
                <label asp-for="BandeiraTarifaria" class="form-label">
                    7. Bandeira Tarifária
                </label>
                <select asp-for="BandeiraTarifaria"
                        class="form-input"
                        asp-items="ViewBag.Bandeiras"
                        required>
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="BandeiraTarifaria" class="form-error"></span>
                <small class="form-hint">Consulte sua conta de luz</small>
            </div>
        </div>

        <div class="form-actions">
            <button type="button"
                    class="btn-action btn-secondary"
                    data-bs-dismiss="modal">
                Cancelar
            </button>
            <button type="submit" class="btn-action btn-success">
                @(isEdit ? "Salvar Alterações" : "Calcular e Salvar")
            </button>
        </div>
    </form>
</div>

<script>
    // Inicializa validação unobtrusive
    if (typeof $.validator !== 'undefined') {
        $.validator.unobtrusive.parse("#formConversor");
    }
</script>