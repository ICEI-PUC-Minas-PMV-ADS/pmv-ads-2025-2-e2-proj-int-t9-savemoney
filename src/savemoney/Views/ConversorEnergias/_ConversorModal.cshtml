@model savemoney.Models.ConversorEnergia
@using Microsoft.AspNetCore.Mvc.Rendering

@{
    bool isEdit = Model.Id != 0;
    string title = isEdit ? "Editar Conversão Salva" : "Nova Conversão de Energia";
}

<div class="modal-header border-0 pb-0">
    <h5 class="modal-title text-white fw-bold">@title</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body pt-4">
    <form asp-action="CreateOrEdit" method="post" id="formConversor">

        @Html.AntiForgeryToken() @* MANTÉM O TOKEN ANTIFORGERY AQUI *@

        @if (isEdit)
        {
            <input type="hidden" asp-for="Id" />
        }

        <div asp-validation-summary="ModelOnly" class="alert alert-danger py-2" role="alert"></div>

        <div class="row g-3">
            <div class="col-md-6">
                <label asp-for="ValorBase" class="form-label text-muted small fw-bold text-uppercase">1. Valor Base (Potência ou Custo)</label>
                <input asp-for="ValorBase" class="form-control form-control-premium money-mask" placeholder="Ex: 500 (Potência) ou 120,50 (Custo)" />
                <span asp-validation-for="ValorBase" class="text-danger small mt-1 d-block"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="TipoValor" class="form-label text-muted small fw-bold text-uppercase">2. Unidade de Medida</label>
                <select asp-for="TipoValor" class="form-select form-select-premium" asp-items="ViewBag.TipoValorOptions">
                    <option value="">Selecione kWh ou Reais</option>
                </select>
                <span asp-validation-for="TipoValor" class="text-danger small mt-1 d-block"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="TipoDispositivo" class="form-label text-muted small fw-bold text-uppercase">3. Tipo de Aparelho</label>
                <select asp-for="TipoDispositivo" class="form-select form-select-premium" asp-items="ViewBag.Dispositivos">
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="TipoDispositivo" class="text-danger small mt-1 d-block"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="TempoUso" class="form-label text-muted small fw-bold text-uppercase">4. Tempo de Uso (Horas/Dia)</label>
                <input asp-for="TempoUso" class="form-control form-control-premium" placeholder="Ex: 5 (Apenas número de horas)" />
                <span asp-validation-for="TempoUso" class="text-danger small mt-1 d-block"></span>
            </div>

            <div class="col-md-4">
                <label asp-for="Estado" class="form-label text-muted small fw-bold text-uppercase">5. Localização (Estado)</label>
                <select asp-for="Estado" class="form-select form-select-premium" asp-items="ViewBag.EstadosBrasil">
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="Estado" class="text-danger small mt-1 d-block"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Modalidade" class="form-label text-muted small fw-bold text-uppercase">6. Modalidade</label>
                <select asp-for="Modalidade" class="form-select form-select-premium" asp-items="ViewBag.Modalidades">
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="Modalidade" class="text-danger small mt-1 d-block"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="BandeiraTarifaria" class="form-label text-muted small fw-bold text-uppercase">7. Bandeira</label>
                <select asp-for="BandeiraTarifaria" class="form-select form-select-premium" asp-items="ViewBag.Bandeiras">
                    <option value="">Selecione...</option>
                </select>
                <span asp-validation-for="BandeiraTarifaria" class="text-danger small mt-1 d-block"></span>
            </div>

            <input type="hidden" asp-for="ConsumoMensal" />

        </div>

        <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top border-secondary border-opacity-25">
            <button type="button" class="btn btn-premium-ghost" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-success fw-bold">Salvar Conversão</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('ValorBase').addEventListener('input', function(e) {
        let value = e.target.value;
        value = value.replace(/[^0-9,]/g, '');
        const parts = value.split(',');
        if (parts.length > 2) value = parts[0] + ',' + parts.slice(1).join('');
        e.target.value = value;
    });
</script>